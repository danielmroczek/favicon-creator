<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SVG Favicon Generator</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
    <link rel="icon" href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzIiIGhlaWdodD0iMzIiIHZpZXdCb3g9IjAgMCAzMiAzMiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjMyIiBoZWlnaHQ9IjMyIiByeD0iNCIgZmlsbD0idXJsKCNncmFkaWVudCkiLz4KPHN2ZyB4PSI4IiB5PSI4IiB3aWR0aD0iMTYiIGhlaWdodD0iMTYiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgc3Ryb2tlPSJ3aGl0ZXNtb2tlIiBzdHJva2Utd2lkdGg9IjIiPgo8cGF0aCBkPSJtMyA5IDktNyA5IDd2MTFhMiAyIDAgMCAxLTIgMkg1YTIgMiAwIDAgMS0yLTJaIi8+CjxwYXRoIGQ9Im05IDIyVjEyaDZWMjIiLz4KPC9zdmc+CjxkZWZzPgo8bGluZWFyR3JhZGllbnQgaWQ9ImdyYWRpZW50IiB4MT0iMTAwJSIgeTE9IjAlIiB4Mj0iMCUiIHkyPSIxMDAlIj4KPHN0b3Agc3RvcC1jb2xvcj0iIzNiODJmNiIvPgo8c3RvcCBvZmZzZXQ9IjEiIHN0b3AtY29sb3I9IiM4YjVjZjYiLz4KPC9saW5lYXJHcmFkaWVudD4KPC9kZWZzPgo8L3N2Zz4K" type="image/svg+xml" id="dynamic-favicon">
    <style>
        :root {
            --preview-size: 200px;
        }
        
        body {
            font-family: system-ui, -apple-system, sans-serif;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem;
        }
        
        .header {
            text-align: center;
            margin-bottom: 3rem;
        }
        
        .header h1 {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 3rem;
            align-items: start;
        }
        
        .preview-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: sticky;
            top: 2rem;
        }
        
        .preview-container {
            width: var(--preview-size);
            height: var(--preview-size);
            border: 2px solid var(--pico-border-color);
            border-radius: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            background: var(--pico-card-background-color);
            margin-bottom: 2rem;
            position: relative;
        }
        
        .preview-container::before {
            content: '';
            position: absolute;
            inset: -2px;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border-radius: 1rem;
            z-index: -1;
        }
        
        #preview-svg {
            width: 80%;
            height: 80%;
            border-radius: 0.5rem;
        }
        
        .controls-section {
            background: var(--pico-card-background-color);
            border-radius: 1rem;
            padding: 2rem;
            border: 1px solid var(--pico-border-color);
        }
        
        .control-group {
            margin-bottom: 2rem;
        }
        
        .control-group h3 {
            margin-bottom: 1rem;
            color: var(--pico-primary-500);
            font-size: 1.1rem;
        }
        
        .color-input-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .color-input {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .color-input input[type="color"] {
            width: 50px;
            height: 40px;
            border: 2px solid var(--pico-border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            background: none;
            padding: 2px;
        }
        
        .color-input input[type="color"]::-webkit-color-swatch-wrapper {
            padding: 0;
        }
        
        .color-input input[type="color"]::-webkit-color-swatch {
            border: none;
            border-radius: 0.25rem;
        }
        
        .icon-search {
            position: relative;
            margin-bottom: 1rem;
        }
        
        .icon-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(40px, 1fr));
            gap: 0.5rem;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid var(--pico-border-color);
            border-radius: 0.5rem;
            padding: 1rem;
            background: var(--pico-background-color);
        }
        
        .icon-item {
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 1px solid var(--pico-border-color);
            border-radius: 0.5rem;
            cursor: pointer;
            transition: all 0.2s ease;
            background: var(--pico-card-background-color);
        }
        
        .icon-item:hover {
            border-color: var(--pico-primary-500);
            background: var(--pico-primary-100);
        }
        
        .icon-item.selected {
            border-color: var(--pico-primary-500);
            background: var(--pico-primary-200);
        }
        
        .range-group {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 1rem;
            align-items: center;
        }
        
        .range-value {
            font-weight: 600;
            min-width: 3rem;
            text-align: center;
            background: var(--pico-background-color);
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
            border: 1px solid var(--pico-border-color);
        }
        
        .position-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .center-button {
            background: var(--pico-primary-500);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
            cursor: pointer;
            font-size: 0.9rem;
            margin-top: 1rem;
            transition: background-color 0.2s ease;
        }
        
        .center-button:hover {
            background: var(--pico-primary-600);
        }
        
        .upload-area {
            border: 2px dashed var(--pico-border-color);
            border-radius: 0.5rem;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .upload-area:hover {
            border-color: var(--pico-primary-500);
            background: var(--pico-primary-50);
        }
        
        .upload-area.dragover {
            border-color: var(--pico-primary-500);
            background: var(--pico-primary-100);
        }
        
        .download-section {
            text-align: center;
            padding-top: 2rem;
            border-top: 1px solid var(--pico-border-color);
        }
        
        .download-button {
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            border: none;
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.5rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            display: inline-block;
        }
        
        .download-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }
        
        @media (max-width: 768px) {
            .main-content {
                grid-template-columns: 1fr;
                gap: 2rem;
            }
            
            .preview-section {
                position: static;
                order: -1;
            }
            
            :root {
                --preview-size: 150px;
            }
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>SVG Favicon Generator</h1>
            <p>Create beautiful SVG favicons with gradients and custom icons</p>
        </header>
        
        <div class="main-content">
            <div class="preview-section">
                <div class="preview-container">
                    <svg id="preview-svg" width="32" height="32" viewBox="0 0 32 32" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <linearGradient id="gradient" x1="100%" y1="0%" x2="0%" y2="100%">
                                <stop stop-color="#3b82f6"/>
                                <stop offset="1" stop-color="#8b5cf6"/>
                            </linearGradient>
                        </defs>
                        <rect width="32" height="32" rx="4" fill="url(#gradient)"/>
                        <svg x="8" y="8" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="whitesmoke" stroke-width="2">
                            <path d="m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <path d="m9 22V12h6V22"/>
                        </svg>
                    </svg>
                </div>
                
                <div class="download-section">
                    <button id="download-btn" class="download-button">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="margin-right: 0.5rem;">
                            <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>
                            <polyline points="7,10 12,15 17,10"/>
                            <line x1="12" y1="15" x2="12" y2="3"/>
                        </svg>
                        Download favicon.svg
                    </button>
                </div>
            </div>
            
            <div class="controls-section">
                <div class="control-group">
                    <h3>Background</h3>
                    <div class="color-input-group">
                        <div class="color-input">
                            <input type="color" id="color1" value="#3b82f6">
                            <label for="color1">Start Color</label>
                        </div>
                        <div class="color-input">
                            <input type="color" id="color2" value="#8b5cf6">
                            <label for="color2">End Color</label>
                        </div>
                    </div>
                    <div class="range-group" style="margin-top: 1rem;">
                        <label for="gradient-angle">Gradient Angle</label>
                        <input type="range" id="gradient-angle" min="0" max="360" value="315">
                        <span class="range-value" id="angle-value">315째</span>
                    </div>
                    <div class="range-group">
                        <label for="border-radius">Border Radius</label>
                        <input type="range" id="border-radius" min="0" max="16" value="4">
                        <span class="range-value" id="radius-value">4</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Icon</h3>
                    <div class="icon-search">
                        <input type="text" id="icon-search" placeholder="Search icons..." style="margin-bottom: 1rem;">
                        <div class="icon-grid" id="icon-grid"></div>
                    </div>
                    
                    <div class="color-input">
                        <input type="color" id="icon-color" value="#f5f5f5">
                        <label for="icon-color">Icon Color</label>
                    </div>
                    
                    <div class="range-group" style="margin-top: 1rem;">
                        <label for="stroke-width">Stroke Width</label>
                        <input type="range" id="stroke-width" min="0.5" max="4" step="0.5" value="2">
                        <span class="range-value" id="stroke-value">2</span>
                    </div>
                </div>
                
                <div class="control-group">
                    <h3>Icon Position, Size & Rotation</h3>
                    <div class="position-controls">
                        <div class="range-group">
                            <label for="icon-x">X Position</label>
                            <input type="range" id="icon-x" min="0" max="32" value="8">
                            <span class="range-value" id="x-value">8</span>
                        </div>
                        <div class="range-group">
                            <label for="icon-y">Y Position</label>
                            <input type="range" id="icon-y" min="0" max="32" value="8">
                            <span class="range-value" id="y-value">8</span>
                        </div>
                    </div>
                    <div class="range-group">
                        <label for="icon-size">Icon Size</label>
                        <input type="range" id="icon-size" min="4" max="28" value="16">
                        <span class="range-value" id="size-value">16</span>
                    </div>
                    <div class="range-group">
                        <label for="icon-rotation">Rotation</label>
                        <input type="range" id="icon-rotation" min="0" max="360" value="0">
                        <span class="range-value" id="rotation-value">0째</span>
                    </div>
                    <button id="center-icon" class="center-button">Center Icon</button>
                </div>
                
                <div class="control-group">
                    <h3>Custom Icon Upload</h3>
                    <div class="upload-area" id="upload-area">
                        <input type="file" id="file-input" accept=".svg" class="hidden">
                        <p>Click or drag to upload custom SVG icon</p>
                        <small>Only SVG files with path elements supported</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/svgo@3.0.2/dist/svgo.browser.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.js"></script>
    <script>
        // Updated icon data - now using official Lucide icon names
        const popularIcons = [
            'home', 'heart', 'star', 'user', 'mail', 'phone', 'globe', 'settings',
            'search', 'plus', 'minus', 'check', 'x', 'menu', 'arrow-right', 'arrow-left',
            'arrow-up', 'arrow-down', 'download', 'upload', 'eye', 'camera', 'image',
            'music', 'video', 'lock', 'key', 'shield', 'bookmark', 'calendar', 'clock',
            'map-pin', 'shopping-cart', 'gift', 'code', 'database', 'wifi', 'cpu',
            'server', 'folder', 'file', 'layers', 'trending-up', 'trending-down',
            'activity', 'zap', 'palette', 'sun', 'moon', 'cloud', 'umbrella', 'coffee',
            'car', 'plane', 'gamepad-2'
        ];

        let currentIcon = popularIcons[0];
        let customIconSvg = null;

        // Elements
        const previewSvg = document.getElementById('preview-svg');
        const color1Input = document.getElementById('color1');
        const color2Input = document.getElementById('color2');
        const gradientAngleInput = document.getElementById('gradient-angle');
        const borderRadiusInput = document.getElementById('border-radius');
        const iconColorInput = document.getElementById('icon-color');
        const strokeWidthInput = document.getElementById('stroke-width');
        const iconXInput = document.getElementById('icon-x');
        const iconYInput = document.getElementById('icon-y');
        const iconSizeInput = document.getElementById('icon-size');
        const iconRotationInput = document.getElementById('icon-rotation');
        const iconSearchInput = document.getElementById('icon-search');
        const iconGrid = document.getElementById('icon-grid');
        const uploadArea = document.getElementById('upload-area');
        const fileInput = document.getElementById('file-input');
        const downloadBtn = document.getElementById('download-btn');
        const centerIconBtn = document.getElementById('center-icon');

        // Value display elements
        const angleValue = document.getElementById('angle-value');
        const radiusValue = document.getElementById('radius-value');
        const xValue = document.getElementById('x-value');
        const yValue = document.getElementById('y-value');
        const sizeValue = document.getElementById('size-value');
        const strokeValue = document.getElementById('stroke-value');
        const rotationValue = document.getElementById('rotation-value');

        // Get Lucide icon SVG content
        function getLucideIconSvg(iconName) {
            try {
                const iconData = lucide.icons[iconName];
                if (iconData) {
                    const svgString = iconData.toSvg();
                    // Parse the SVG to extract just the path content
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(svgString, 'image/svg+xml');
                    const paths = doc.querySelectorAll('path, circle, rect, ellipse, line, polyline, polygon');
                    let pathContent = '';
                    paths.forEach(path => {
                        pathContent += path.outerHTML;
                    });
                    return pathContent;
                }
            } catch (error) {
                console.warn(`Icon ${iconName} not found, using fallback`);
            }
            // Fallback to a simple circle if icon not found
            return '<circle cx="12" cy="12" r="10"/>';
        }

        // Update favicon dynamically
        function updateFavicon() {
            const svgString = previewSvg.outerHTML;
            const base64 = btoa(unescape(encodeURIComponent(svgString)));
            const dataUrl = `data:image/svg+xml;base64,${base64}`;
            
            const favicon = document.getElementById('dynamic-favicon');
            favicon.href = dataUrl;
        }

        // Center icon functionality
        centerIconBtn.addEventListener('click', () => {
            const iconSize = parseInt(iconSizeInput.value);
            const centerX = (32 - iconSize) / 2;
            const centerY = (32 - iconSize) / 2;
            
            iconXInput.value = centerX;
            iconYInput.value = centerY;
            
            updateValueDisplays();
            updatePreview();
        });

        // Initialize icon grid function
        function initIconGrid() {
            iconGrid.innerHTML = '';
            popularIcons.forEach((iconName, index) => {
                const iconElement = document.createElement('div');
                iconElement.className = 'icon-item';
                if (index === 0) iconElement.classList.add('selected');
                
                // Create a temporary div to parse the Lucide SVG
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = getLucideIconSvg(iconName);
                const lucideSvg = tempDiv.querySelector('svg');
                
                if (lucideSvg) {
                    lucideSvg.setAttribute('width', '20');
                    lucideSvg.setAttribute('height', '20');
                    lucideSvg.setAttribute('stroke', 'currentColor');
                    iconElement.appendChild(lucideSvg);
                } else {
                    // Create SVG wrapper for the path content
                    const svgWrapper = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                    svgWrapper.setAttribute('width', '20');
                    svgWrapper.setAttribute('height', '20');
                    svgWrapper.setAttribute('viewBox', '0 0 24 24');
                    svgWrapper.setAttribute('fill', 'none');
                    svgWrapper.setAttribute('stroke', 'currentColor');
                    svgWrapper.setAttribute('stroke-width', '2');
                    svgWrapper.innerHTML = getLucideIconSvg(iconName);
                    iconElement.appendChild(svgWrapper);
                }
                
                iconElement.addEventListener('click', () => {
                    document.querySelectorAll('.icon-item').forEach(item => item.classList.remove('selected'));
                    iconElement.classList.add('selected');
                    currentIcon = iconName;
                    customIconSvg = null;
                    updatePreview();
                });
                
                iconGrid.appendChild(iconElement);
            });
        }

        // Search icons
        iconSearchInput.addEventListener('input', (e) => {
            const searchTerm = e.target.value.toLowerCase();
            const filteredIcons = popularIcons.filter(iconName => 
                iconName.toLowerCase().includes(searchTerm)
            );
            
            iconGrid.innerHTML = '';
            filteredIcons.forEach(iconName => {
                const iconElement = document.createElement('div');
                iconElement.className = 'icon-item';
                
                // Create SVG wrapper for the path content
                const svgWrapper = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
                svgWrapper.setAttribute('width', '20');
                svgWrapper.setAttribute('height', '20');
                svgWrapper.setAttribute('viewBox', '0 0 24 24');
                svgWrapper.setAttribute('fill', 'none');
                svgWrapper.setAttribute('stroke', 'currentColor');
                svgWrapper.setAttribute('stroke-width', '2');
                svgWrapper.innerHTML = getLucideIconSvg(iconName);
                iconElement.appendChild(svgWrapper);
                
                iconElement.addEventListener('click', () => {
                    document.querySelectorAll('.icon-item').forEach(item => item.classList.remove('selected'));
                    iconElement.classList.add('selected');
                    currentIcon = iconName;
                    customIconSvg = null;
                    updatePreview();
                });
                
                iconGrid.appendChild(iconElement);
            });
        });

        // Update preview
        function updatePreview() {
            const angle = parseInt(gradientAngleInput.value);
            const radius = parseInt(borderRadiusInput.value);
            const color1 = color1Input.value;
            const color2 = color2Input.value;
            const iconColor = iconColorInput.value;
            const strokeWidth = parseFloat(strokeWidthInput.value);
            const iconX = parseInt(iconXInput.value);
            const iconY = parseInt(iconYInput.value);
            const iconSize = parseInt(iconSizeInput.value);
            const iconRotation = parseInt(iconRotationInput.value);

            // Calculate gradient coordinates based on angle
            const radians = (angle - 90) * Math.PI / 180;
            const x1 = Math.round((1 + Math.cos(radians)) * 50);
            const y1 = Math.round((1 + Math.sin(radians)) * 50);
            const x2 = Math.round((1 - Math.cos(radians)) * 50);
            const y2 = Math.round((1 - Math.sin(radians)) * 50);

            let iconContent = '';
            if (customIconSvg) {
                // For custom SVG, create a new SVG element with current controls applied
                const centerX = iconX + iconSize / 2;
                const centerY = iconY + iconSize / 2;
                const rotationTransform = iconRotation !== 0 ? `rotate(${iconRotation} ${centerX} ${centerY})` : '';
                
                // Replace currentColor with actual color in the elements
                const coloredElements = customIconSvg.elements.replace(/currentColor/g, iconColor).replace(/inherit/g, strokeWidth);
                
                iconContent = `
                    <svg x="${iconX}" y="${iconY}" 
                         width="${iconSize}" height="${iconSize}" 
                         viewBox="${customIconSvg.viewBox}"
                         fill="none"
                         ${rotationTransform ? `transform="${rotationTransform}"` : ''}
                         xmlns="http://www.w3.org/2000/svg">
                        ${coloredElements}
                    </svg>
                `;
            } else {
                // For Lucide icons, get the path content and create SVG
                const pathContent = getLucideIconSvg(currentIcon);
                const centerX = iconX + iconSize / 2;
                const centerY = iconY + iconSize / 2;
                const rotationTransform = iconRotation !== 0 ? `rotate(${iconRotation} ${centerX} ${centerY})` : '';
                
                iconContent = `
                    <svg x="${iconX}" y="${iconY}" 
                         width="${iconSize}" height="${iconSize}" 
                         viewBox="0 0 24 24"
                         fill="none"
                         stroke="${iconColor}"
                         stroke-width="${strokeWidth}"
                         ${rotationTransform ? `transform="${rotationTransform}"` : ''}
                         xmlns="http://www.w3.org/2000/svg">
                        ${pathContent}
                    </svg>
                `;
            }

            previewSvg.innerHTML = `
                <defs>
                    <linearGradient id="gradient" x1="${x1}%" y1="${y1}%" x2="${x2}%" y2="${y2}%">
                        <stop stop-color="${color1}"/>
                        <stop offset="1" stop-color="${color2}"/>
                    </linearGradient>
                </defs>
                <rect width="32" height="32" rx="${radius}" fill="url(#gradient)"/>
                ${iconContent}
            `;
            
            updateFavicon();
        }

        // Update value displays
        function updateValueDisplays() {
            angleValue.textContent = gradientAngleInput.value + '째';
            radiusValue.textContent = borderRadiusInput.value;
            xValue.textContent = iconXInput.value;
            yValue.textContent = iconYInput.value;
            sizeValue.textContent = iconSizeInput.value;
            strokeValue.textContent = strokeWidthInput.value;
            rotationValue.textContent = iconRotationInput.value + '째';
        }

        // Event listeners
        [color1Input, color2Input, gradientAngleInput, borderRadiusInput, 
         iconColorInput, strokeWidthInput, iconXInput, iconYInput, iconSizeInput, iconRotationInput].forEach(input => {
            input.addEventListener('input', () => {
                updatePreview();
                updateValueDisplays();
            });
        });

        // File upload
        uploadArea.addEventListener('click', () => fileInput.click());
        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('dragover');
        });
        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('dragover');
        });
        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('dragover');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                handleFileUpload(files[0]);
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFileUpload(e.target.files[0]);
            }
        });

        function handleFileUpload(file) {
            // Only accept SVG files
            if (file.type !== 'image/svg+xml') {
                alert('Please upload only SVG files.');
                return;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                const svgContent = e.target.result;
                const parser = new DOMParser();
                const svgDoc = parser.parseFromString(svgContent, 'image/svg+xml');
                const svgElement = svgDoc.documentElement;
                
                // Check for parsing errors
                if (svgElement.tagName !== 'svg') {
                    alert('Invalid SVG file.');
                    return;
                }
                
                // Extract only path elements (excluding metadata like title, desc, etc.)
                const pathElements = svgElement.querySelectorAll('path, circle, rect, ellipse, line, polyline, polygon');
                
                if (pathElements.length === 0) {
                    alert('SVG must contain at least one drawable element (path, circle, rect, etc.).');
                    return;
                }
                
                // Create a new SVG with extracted elements, removing fills and ensuring stroke styling
                let elementsContent = '';
                pathElements.forEach(element => {
                    const elementClone = element.cloneNode(true);
                    
                    // Remove any fill attributes to make it transparent
                    elementClone.removeAttribute('fill');
                    elementClone.setAttribute('fill', 'none');
                    
                    // Set stroke properties that will be controlled by our controls
                    elementClone.setAttribute('stroke', 'currentColor');
                    elementClone.setAttribute('stroke-width', 'inherit');
                    
                    elementsContent += elementClone.outerHTML;
                });
                
                // Get the original viewBox or use default
                const originalViewBox = svgElement.getAttribute('viewBox') || '0 0 24 24';
                
                // Store the clean elements content for use in updatePreview
                customIconSvg = {
                    viewBox: originalViewBox,
                    elements: elementsContent
                };
                
                updatePreview();
                alert('SVG elements extracted and applied successfully!');
            };
            reader.readAsText(file);
        }

        // Download functionality
        downloadBtn.addEventListener('click', async () => {
            const svgString = previewSvg.outerHTML;
            
            try {
                // Minify with SVGO
                const optimizedSvg = SVGO.optimize(svgString, {
                    plugins: [
                        'preset-default',
                        'removeViewBox',
                        'removeDimensions'
                    ]
                });
                
                const blob = new Blob([optimizedSvg.data], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'favicon.svg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            } catch (error) {
                // Fallback without SVGO
                const blob = new Blob([svgString], { type: 'image/svg+xml' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'favicon.svg';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }
        });

        // Initialize
        initIconGrid();
        updatePreview();
        updateValueDisplays();
    </script>
</body>
</html>
